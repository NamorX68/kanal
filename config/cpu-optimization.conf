# ProxMox CPU Optimization for Intel i5-13420H
# 13th Gen Intel Core with P-cores and E-cores

# CPU Governor Settings
echo "performance" > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
echo "performance" > /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
echo "performance" > /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
echo "performance" > /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor

# P-cores: CPU 0-7 (with Hyperthreading)
# E-cores: CPU 8-11

# Kernel parameters for Intel 13th Gen
# Add to /etc/default/grub GRUB_CMDLINE_LINUX_DEFAULT
intel_pstate=active
processor.max_cstate=1
intel_idle.max_cstate=0
mitigations=off
hugepages=1024

# CPU isolation for critical VMs (optional)
# isolcpus=4-7  # Isolate some cores for specific VMs

# Intel VT-x/VT-d settings
iommu=pt
intel_iommu=on

# Performance tuning
vm.swappiness=10
vm.dirty_ratio=15
vm.dirty_background_ratio=5

# CPU frequency scaling
cpufreq.default_governor=performance

# Disable CPU vulnerabilities mitigations for better performance
# (only if security is not a primary concern)
nospectre_v1 nospectre_v2 nopti nospectre_v2_user spec_store_bypass_disable=off l1tf=off mds=off tsx_async_abort=off mitigations=off